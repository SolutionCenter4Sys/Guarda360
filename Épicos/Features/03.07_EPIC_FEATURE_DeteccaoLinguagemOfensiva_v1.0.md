# F-03.07 — Detecção de Linguagem Ofensiva por IA

**Épico**: EP-03 — Comunicação Monitorada  
**Agente**: @the-explorer  
**Versão**: 1.0 | **Data**: 2026-02-24

---

## 1. Descrição da Feature

Sistema de análise automática de mensagens de texto para detectar linguagem ofensiva, ameaças ou indícios de alienação parental. Exibe alerta visual na mensagem sem bloqueá-la (a mensagem é enviada de qualquer forma — a imutabilidade prevalece). O alerta serve como evidência adicional no relatório jurídico.

---

## 2. Solução Proposta

MVP: Lista de palavras/frases proibidas com análise por regex (sem IA complexa). Fase 2: integração com API de NLP (ex: Google Natural Language API ou modelo open-source). O sistema analisa a mensagem após o INSERT e atualiza o campo `offensive_detected = true` se detectar conteúdo problemático.

---

## 3. Escopo

### O que ENTRA (MVP — lista de palavras)
- Lista configurável de palavras/frases ofensivas em PT-BR (dicionário no banco)
- Análise após envio (assíncrona, não bloqueia o envio)
- Campo `offensive_detected` atualizado no banco
- Alerta visual no frontend: ícone ⚠️ vermelho acima da mensagem
- Filtro no histórico para ver apenas mensagens com alerta
- Inclusão no relatório jurídico com marcação especial

### O que NÃO ENTRA (MVP)
- NLP avançado para detecção contextual — fase 2
- Detecção em áudios (transcrição + análise) — fase 2
- Bloqueio/moderação de mensagens — jamais (imutabilidade)

---

## 4. Premissas

- A detecção é assíncrona: a mensagem é salva primeiro, analisada depois
- False positives são esperados e aceitáveis — o usuário pode contestar (apenas visual)
- A lista de palavras pode ser expandida via configuração de admin (sem deploy)

---

## 5. User Stories

| US | Tipo | Descrição | Esforço |
|----|------|-----------|---------|
| US-03.07.01 | Frontend | Como responsável, quero ver o ícone ⚠️ em mensagens detectadas como ofensivas | 2 |
| US-03.07.02 | Frontend | Como responsável, quero filtrar o histórico de chat para ver apenas mensagens com alerta | 2 |
| US-03.07.03 | Backend | Serviço de análise: varredura por lista de palavras ofensivas após INSERT da mensagem | 5 |
| US-03.07.04 | Backend | Atualização do campo offensive_detected após análise (único update permitido) | 2 |
| US-03.07.05 | Backend | Admin: endpoint para gerenciar lista de palavras ofensivas | 3 |

**Esforço Total**: 14 pontos

---

## 6. Critérios de Aceitação

- [ ] Alerta aparece no frontend em < 3 segundos após o envio da mensagem
- [ ] Mensagem com palavra da lista tem `offensive_detected = true` no banco
- [ ] Mensagem ofensiva detectada aparece com marcação especial no relatório PDF
- [ ] A mensagem é enviada normalmente (não é bloqueada)

---

## 7. Complexidade Técnica

**Nível**: Baixa-Média | **Pontos**: 14  
**Riscos**: Alto índice de false positives com abordagem de lista de palavras — documentar limitação
