# F-06.01 — Registro Formal de Ocorrências e Incidentes

**Épico**: EP-06 — Ocorrências & Incidentes  
**Agente**: @the-explorer  
**Versão**: 1.0 | **Data**: 2026-02-24

---

## 1. Descrição da Feature

Sistema de registro formal de fatos relevantes relacionados à guarda. Cada ocorrência tem campo narrativo livre, tipo (alienação parental, descumprimento, risco, outro), gravidade (Baixa, Média, Alta, Crítica), upload de evidências e timestamp imutável. Ocorrências privadas do responsável que registrou — visíveis apenas pelo próprio e pelo advogado autorizado.

---

## 2. Solução Proposta

Interface de formulário guiado:
1. Seleção do tipo de ocorrência
2. Seleção de gravidade
3. Campo narrativo (texto livre, até 5.000 caracteres)
4. Upload de evidências (fotos, áudios, prints, documentos)
5. Confirmação e geração de hash de integridade
6. Registro imutável persistido com timestamp do servidor

---

## 3. Escopo

### O que ENTRA
- Formulário de registro com tipo, gravidade, narrativa e evidências
- Upload de múltiplos arquivos de evidência (até 5 arquivos, 20MB total)
- Timestamp imutável do servidor
- Hash SHA-256 da ocorrência
- Classificação por tipo: Alienação Parental, Descumprimento de Guarda, Situação de Risco, Outro
- Classificação por gravidade: Baixa, Média, Alta, Crítica
- Ocorrência privada do responsável (não visível para o outro responsável)
- Exportação para relatório jurídico (EP-07)

### O que NÃO ENTRA
- Notificação automática da Vara da Família — fase Judicial
- Painel de análise de padrões — fase 2
- Registro compartilhado entre os dois responsáveis — por design, é privado

---

## 4. Premissas

- Ocorrência é sempre privada do responsável que registrou
- Nunca é visível para o outro responsável diretamente (apenas via relatório judicial)
- Hash é gerado no momento do registro e não muda
- Evidências fazem parte do hash (hash do conjunto)
- Qualquer responsável pode registrar ocorrências

---

## 5. User Stories

| US | Tipo | Descrição | Esforço |
|----|------|-----------|---------|
| US-06.01.01 | Frontend | Como responsável, quero registrar uma ocorrência com tipo, gravidade e narrativa | 3 |
| US-06.01.02 | Frontend | Como responsável, quero fazer upload de até 5 evidências em uma ocorrência | 3 |
| US-06.01.03 | Frontend | Como responsável, quero ver meu histórico de ocorrências com filtro por tipo e gravidade | 3 |
| US-06.01.04 | Frontend | Como responsável, quero ver o hash de integridade da minha ocorrência | 1 |
| US-06.01.05 | Backend | Endpoint POST /incidents — cria ocorrência com timestamp servidor | 3 |
| US-06.01.06 | Backend | Upload de evidências para S3 com URL assinada | 3 |
| US-06.01.07 | Backend | Geração de hash SHA-256 (narrativa + arquivos + timestamp) | 3 |
| US-06.01.08 | Backend | Regra: ocorrências são INSERT-only, sem UPDATE ou DELETE | 2 |
| US-06.01.09 | Backend | Endpoint GET /incidents — lista ocorrências do responsável autenticado | 2 |
| US-06.01.10 | Backend | Notificação para advogado cadastrado se gravidade >= Alta | 2 |

**Esforço Total**: 25 pontos

---

## 6. Critérios de Aceitação

- [ ] Hash SHA-256 gerado e exibido após registro
- [ ] Ocorrência não aparece para o outro responsável no app
- [ ] Evidências acessíveis 30 dias após upload mínimo (política de retenção S3)
- [ ] Formulário completo em < 3 minutos

---

## 7. Complexidade Técnica

**Nível**: Média  
**Pontos**: 25  
**Riscos**: Geração de hash consistente (ordem dos arquivos, encoding da narrativa), privacidade entre responsáveis no RBAC
