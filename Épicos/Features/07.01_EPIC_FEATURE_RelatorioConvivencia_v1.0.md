# F-07.01 — Relatório de Histórico de Convivência

**Épico**: EP-07 — Relatórios & Exportação Jurídica  
**Agente**: @the-explorer  
**Versão**: 1.0 | **Data**: 2026-02-24

---

## 1. Descrição da Feature

Geração de relatório PDF específico sobre o histórico de convivência: todos os eventos do calendário com seus registros de cumprimento (check-in/out), atrasos, faltas e cancelamentos no período selecionado. Principal peça probatória em processos de revisão de guarda por descumprimento.

---

## 2. Solução Proposta

Template PDF de convivência com: resumo estatístico (% cumprimento, total por status), tabela detalhada de eventos e coluna de registros reais (horário previsto vs. horário real), e narrativa por mês. Cada registro exibe o timestamp do servidor (UTC + local).

---

## 3. Escopo

### O que ENTRA
- Resumo estatístico do período: total de visitas, % cumpridas, % com atraso, % faltas, % cancelamentos
- Tabela detalhada: data prevista, hora prevista, responsável ativo, status, hora real (check-in), atraso calculado, observação
- Seção por mês para facilitar a leitura
- Comparação entre o calendário esperado (configuração) e o realizado (registros)
- Hash SHA-256 do relatório

### O que NÃO ENTRA
- Análise de tendências — fase 2
- Visualização gráfica no PDF — fase 2

---

## 4. Premissas

- O relatório mostra dados de ambos os responsáveis (visão compartilhada)
- Eventos sem nenhum registro aparecem como "Sem registro" (atenção jurídica)
- Período mínimo: 1 mês; máximo: 24 meses (no MVP)

---

## 5. User Stories

| US | Tipo | Descrição | Esforço |
|----|------|-----------|---------|
| US-07.01.01 | Frontend | Como responsável, quero gerar relatório de convivência selecionando período | 2 |
| US-07.01.02 | Backend | Endpoint POST /reports/attendance — enfileira job | 2 |
| US-07.01.03 | Backend | Worker: template HTML de convivência com estatísticas e tabela detalhada | 8 |
| US-07.01.04 | Backend | Query: agrega calendar_events + attendance_records no período | 3 |

**Esforço Total**: 15 pontos

---

## 6. Critérios de Aceitação

- [ ] PDF de 6 meses gerado em < 90 segundos
- [ ] Estatísticas do PDF conferem com o painel de histórico do app
- [ ] Eventos sem registro aparecem destacados em amarelo/vermelho

---

## 7. Complexidade Técnica

**Nível**: Média | **Pontos**: 15
