# F-04.10 — Exportação PDF Relatório Financeiro

**Épico**: EP-04 — Gestão Financeira  
**Agente**: @the-explorer  
**Versão**: 1.0 | **Data**: 2026-02-24

---

## 1. Descrição da Feature

Geração de relatório PDF exclusivamente financeiro: histórico de pensão (pago/atrasado/contestado por mês), despesas extraordinárias aprovadas e contestadas, cálculo de inadimplência e comprovantes anexados como referência. Pronto para uso em processos de execução de alimentos.

---

## 2. Solução Proposta

Usa o mesmo worker Puppeteer dos relatórios gerais (EP-07) com template específico para o módulo financeiro. Permite selecionar período e escolher se inclui apenas inadimplências ou todos os movimentos. Hash SHA-256 do PDF gerado.

---

## 3. Escopo

### O que ENTRA
- Capa com dados do processo (filho, responsáveis, período, data de geração)
- Tabela de pensão por mês com status, datas e valores
- Tabela de despesas extraordinárias com status e valor
- Resumo de inadimplência (total em aberto)
- Lista de comprovantes por referência (não embute os arquivos, apenas referencia com hash)
- Hash SHA-256 do PDF

### O que NÃO ENTRA
- Embutir os comprovantes no PDF — tamanho proibitivo; referência por hash é suficiente
- Assinatura ICP-Brasil — fase Judicial

---

## 4. Premissas

- O PDF financeiro pode ser gerado como parte do relatório geral (EP-07) ou isoladamente
- Geração assíncrona (BullMQ) — o usuário recebe email quando pronto
- PDF armazenado no S3 por 90 dias

---

## 5. User Stories

| US | Tipo | Descrição | Esforço |
|----|------|-----------|---------|
| US-04.10.01 | Frontend | Como responsável, quero gerar um relatório PDF financeiro selecionando o período | 2 |
| US-04.10.02 | Frontend | Como responsável, quero baixar o PDF e ver o hash de integridade | 1 |
| US-04.10.03 | Backend | Endpoint POST /reports/financial — enfileira geração do PDF financeiro | 2 |
| US-04.10.04 | Backend | Worker: template HTML financeiro renderizado com Puppeteer | 5 |
| US-04.10.05 | Backend | Hash SHA-256 do PDF e upload para S3 | 2 |
| US-04.10.06 | Backend | Email com link de download quando PDF estiver pronto | 2 |

**Esforço Total**: 14 pontos

---

## 6. Critérios de Aceitação

- [ ] PDF de 12 meses gerado em < 90 segundos
- [ ] Hash SHA-256 verificável externamente
- [ ] Todos os valores conferem com o painel financeiro do app
- [ ] Email de entrega chega em < 5 minutos

---

## 7. Complexidade Técnica

**Nível**: Média | **Pontos**: 14
