# F-07.04 — Relatório de Incidentes Registrados

**Épico**: EP-07 — Relatórios & Exportação Jurídica  
**Agente**: @the-explorer  
**Versão**: 1.0 | **Data**: 2026-02-24

---

## 1. Descrição da Feature

Seção do relatório jurídico focada em ocorrências e incidentes: lista completa de ocorrências do período com narrativa integral, classificação por tipo e gravidade, evidências referenciadas e hashes de integridade. Ordenada por gravidade decrescente para facilitar a leitura jurídica.

---

## 2. Solução Proposta

Template PDF de incidentes com: capa de resumo (total por tipo e gravidade), seção por ocorrência com narrativa completa, data do fato vs. data de registro, evidências referenciadas com hashes individuais, hash de integridade da ocorrência e hash final do PDF.

---

## 3. Escopo

### O que ENTRA
- Sumário: total de ocorrências por tipo e gravidade no período
- Por ocorrência: data do fato, data de registro, tipo, gravidade, narrativa completa, quantidade de evidências, lista de hashes de evidências, hash de integridade da ocorrência
- Ordenação: Crítica → Alta → Média → Baixa, por data decrescente dentro de cada nível
- Padrões detectados (se F-06.08 indicar padrão)
- Hash SHA-256 do relatório

### O que NÃO ENTRA
- Embutir evidências (fotos/vídeos) — apenas referências por hash
- Análise jurídica das ocorrências — responsabilidade do advogado

---

## 4. Premissas

- Apenas ocorrências do responsável que gerou o relatório
- O advogado pode gerar o mesmo relatório para o seu cliente
- Prazo máximo de geração: 5 minutos para 200 ocorrências

---

## 5. User Stories

| US | Tipo | Descrição | Esforço |
|----|------|-----------|---------|
| US-07.04.01 | Frontend | Como responsável, quero gerar relatório exclusivo de incidentes por período | 2 |
| US-07.04.02 | Backend | Endpoint POST /reports/incidents-legal — enfileira job | 2 |
| US-07.04.03 | Backend | Worker: template HTML de incidentes com narrativas e hashes | 8 |
| US-07.04.04 | Backend | Query: incidents + evidences no período, ordenados por gravidade | 3 |

**Esforço Total**: 15 pontos

---

## 6. Critérios de Aceitação

- [ ] PDF de 50 ocorrências gerado em < 120 segundos
- [ ] Todos os hashes de ocorrências verificáveis individualmente
- [ ] Ordenação por gravidade correta
- [ ] Padrão detectado (F-06.08) aparece como box de destaque no relatório

---

## 7. Complexidade Técnica

**Nível**: Média | **Pontos**: 15
