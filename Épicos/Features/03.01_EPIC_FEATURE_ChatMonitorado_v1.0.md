# F-03.01 — Chat Interno Monitorado com Validade Jurídica

**Épico**: EP-03 — Comunicação Monitorada  
**Agente**: @the-explorer  
**Versão**: 1.0 | **Data**: 2026-02-24

---

## 1. Descrição da Feature

Canal de mensagens interno entre os responsáveis legais de um filho. Diferente de WhatsApp, as mensagens nunca podem ser excluídas por nenhuma das partes. Cada mensagem tem timestamp imutável. O histórico é exportável como PDF com valor jurídico.

---

## 2. Solução Proposta

Interface de chat estilo WhatsApp com:
- Bolhas de mensagem diferenciadas por responsável
- Timestamp visível em cada mensagem (data + hora)
- Suporte a texto, áudio e anexos (fotos, documentos)
- Marcação de mensagens como "juridicamente relevantes" (destaque)
- Sem botão de deletar/editar mensagens
- Indicador de entrega e leitura (✓✓)
- Alerta visual quando linguagem ofensiva é detectada pela IA

---

## 3. Escopo

### O que ENTRA
- Troca de mensagens de texto em tempo real (WebSocket)
- Envio de áudio (gravado no app)
- Envio de fotos e documentos (até 10MB por arquivo)
- Timestamp de servidor em cada mensagem
- Marcação de mensagem como "relevante"
- Indicador de leitura
- Detecção básica de linguagem ofensiva (lista de palavras)
- Notificação push para mensagem não lida

### O que NÃO ENTRA
- Chat em grupo (múltiplos participantes) — fase 2
- Chamada de voz/vídeo — fase 2
- IA avançada de análise de contexto — fase 2
- Criptografia E2E no MVP (será implementada na fase de segurança)

---

## 4. Premissas

- Chat existe por par de responsáveis × filho (um chat por filho)
- Mensagens são armazenadas indefinidamente
- Nenhum usuário (incluindo admin) pode excluir mensagens
- Áudios têm limite de 5 minutos

---

## 5. User Stories

| US | Tipo | Descrição | Esforço |
|----|------|-----------|---------|
| US-03.01.01 | Frontend | Como responsável, quero enviar e receber mensagens de texto em tempo real | 5 |
| US-03.01.02 | Frontend | Como responsável, quero gravar e enviar áudio diretamente no app | 3 |
| US-03.01.03 | Frontend | Como responsável, quero enviar fotos e documentos | 3 |
| US-03.01.04 | Frontend | Como responsável, quero marcar uma mensagem como juridicamente relevante | 2 |
| US-03.01.05 | Frontend | Como responsável, quero ver alerta visual quando linguagem ofensiva é detectada | 2 |
| US-03.01.06 | Frontend | Como responsável, quero receber notificação push de mensagem não lida | 2 |
| US-03.01.07 | Backend | WebSocket Gateway para troca de mensagens em tempo real | 8 |
| US-03.01.08 | Backend | Endpoint POST /messages — persiste mensagem com timestamp servidor | 3 |
| US-03.01.09 | Backend | Endpoint GET /messages/{childId}?cursor=... — paginação de histórico | 3 |
| US-03.01.10 | Backend | Upload de arquivos de mídia para S3 | 3 |
| US-03.01.11 | Backend | Serviço de detecção de linguagem ofensiva (lista de palavras proibidas) | 3 |
| US-03.01.12 | Backend | Proibição em nível de banco: mensagens são INSERT-only (sem UPDATE/DELETE) | 3 |

**Esforço Total**: 40 pontos

---

## 6. Critérios de Aceitação

- [ ] Mensagem enviada aparece no outro device em < 2 segundos
- [ ] Não existe botão de excluir ou editar mensagem
- [ ] Áudio de 1 minuto enviado com sucesso (< 10s de upload)
- [ ] Mensagem marcada como relevante aparece destacada
- [ ] Alerta de linguagem ofensiva é exibido em < 1 segundo

---

## 7. Complexidade Técnica

**Nível**: Alta  
**Pontos**: 40  
**Riscos**: WebSocket em produção (escalabilidade), armazenamento de mídia (custo S3), garantia de insert-only no banco
