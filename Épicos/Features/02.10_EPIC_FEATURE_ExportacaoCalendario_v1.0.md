# F-02.10 — Exportação do Calendário (PDF / iCal)

**Épico**: EP-02 — Guarda & Convivência  
**Agente**: @the-explorer  
**Versão**: 1.0 | **Data**: 2026-02-24

---

## 1. Descrição da Feature

Exportação do calendário de convivência em dois formatos: PDF visual (para impressão e uso em processos) e iCal/ICS (para sincronização com Google Calendar, Apple Calendar, Outlook). Permite que os responsáveis integrem o calendário de guarda com sua agenda pessoal.

---

## 2. Solução Proposta

- PDF: gerado via Puppeteer (mesmo worker dos relatórios) com layout mensal colorido
- iCal: arquivo .ics gerado on-demand com eventos do período selecionado; também disponível como URL de assinatura (calendário vivo que se atualiza automaticamente)

---

## 3. Escopo

### O que ENTRA
- Export PDF: calendário mensal/trimestral com codificação de cores por responsável
- Export iCal: arquivo .ics para importação manual
- URL de assinatura iCal: link permanente para sincronização automática com apps de calendário
- Seleção de período para exportação

### O que NÃO ENTRA
- Integração bidirecional (modificar eventos via Google Calendar) — fase 2
- Export em formato Excel/Google Sheets — fase 2

---

## 4. Premissas

- A URL de assinatura iCal é autenticada via token de calendário (diferente do JWT de sessão, pois apps de calendário não gerenciam cookies)
- O PDF do calendário não contém informações sensíveis (apenas datas e responsável ativo)

---

## 5. User Stories

| US | Tipo | Descrição | Esforço |
|----|------|-----------|---------|
| US-02.10.01 | Frontend | Como responsável, quero exportar o calendário de um período em PDF | 2 |
| US-02.10.02 | Frontend | Como responsável, quero baixar o arquivo .ics para importar no Google Calendar | 2 |
| US-02.10.03 | Frontend | Como responsável, quero copiar a URL de assinatura iCal para sincronização automática | 1 |
| US-02.10.04 | Backend | Endpoint GET /calendar/export/pdf/:childId?from=&to= — gera PDF do calendário | 5 |
| US-02.10.05 | Backend | Endpoint GET /calendar/export/ical/:childId?from=&to= — gera arquivo .ics | 3 |
| US-02.10.06 | Backend | Endpoint GET /calendar/subscribe/:calendarToken — URL de assinatura viva (iCal feed) | 3 |

**Esforço Total**: 16 pontos

---

## 6. Critérios de Aceitação

- [ ] Arquivo .ics importado no Google Calendar mostra todos os eventos corretamente
- [ ] PDF do calendário tem legenda de cores e é legível em impressão A4
- [ ] URL de assinatura funciona no Google Calendar, Apple Calendar e Outlook
- [ ] Token de calendário é diferente do JWT de sessão (segurança)

---

## 7. Complexidade Técnica

**Nível**: Média | **Pontos**: 16  
**Riscos**: Formato iCal tem quirks específicos por app (Google vs Apple vs Outlook)
