# F-07.02 — Relatório de Conversas Selecionadas do Chat

**Épico**: EP-07 — Relatórios & Exportação Jurídica  
**Agente**: @the-explorer  
**Versão**: 1.0 | **Data**: 2026-02-24

---

## 1. Descrição da Feature

Geração de relatório PDF do histórico de chat com opções de filtro: apenas mensagens marcadas como juridicamente relevantes, todas as mensagens do período, ou mensagens com alerta de linguagem ofensiva. Inclui metadados de cada mensagem (remetente, timestamp servidor, tipo de conteúdo).

---

## 2. Solução Proposta

Template PDF de chat com layout tipo conversa (semelhante ao WhatsApp impresso), mas com metadados jurídicos adicionais. Cabeçalho com dados do caso, seções por mês, mensagens com remetente e timestamp. Mensagens relevantes destacadas em amarelo; mensagens ofensivas em vermelho.

---

## 3. Escopo

### O que ENTRA
- Opção: apenas relevantes / todas as mensagens / apenas com alerta ofensivo
- Período selecionável
- Layout: mensagens com remetente, timestamp (local + UTC), tipo de conteúdo
- Mensagens relevantes destacadas visualmente no PDF
- Mensagens ofensivas com alerta visual
- Metadados de mídias: "[Áudio - 1min32s]", "[Imagem]", "[Documento: nome.pdf]"
- Hash SHA-256 do relatório

### O que NÃO ENTRA
- Embutir mídias (áudio, imagens) no PDF — apenas referências
- Transcrição automática de áudios — fase 2

---

## 4. Premissas

- O PDF mostra mensagens de ambos os responsáveis (conversa completa)
- O responsável que gera o relatório determina quais mensagens incluir
- Período máximo: 12 meses no MVP (relatórios mais longos serão assíncronos)

---

## 5. User Stories

| US | Tipo | Descrição | Esforço |
|----|------|-----------|---------|
| US-07.02.01 | Frontend | Como responsável, quero escolher quais mensagens incluir e o período | 2 |
| US-07.02.02 | Backend | Endpoint POST /reports/chat — enfileira job | 2 |
| US-07.02.03 | Backend | Worker: template HTML de chat com destacamento de relevantes e ofensivas | 8 |
| US-07.02.04 | Backend | Query: mensagens filtradas por período e tipo (relevante/ofensiva/todas) | 3 |

**Esforço Total**: 15 pontos

---

## 6. Critérios de Aceitação

- [ ] PDF de 30 dias de chat gerado em < 60 segundos
- [ ] Mensagens relevantes destacadas em amarelo no PDF
- [ ] Timestamps no PDF em formato "DD/MM/AAAA HH:mm (UTC)"
- [ ] Hash SHA-256 verificável externamente

---

## 7. Complexidade Técnica

**Nível**: Alta | **Pontos**: 15  
**Riscos**: Volume de mensagens pode tornar o PDF muito grande — implementar paginação por seção
