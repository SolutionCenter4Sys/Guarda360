# F-03.05 — Marcação de Mensagens Juridicamente Relevantes

**Épico**: EP-03 — Comunicação Monitorada  
**Agente**: @the-explorer  
**Versão**: 1.0 | **Data**: 2026-02-24

---

## 1. Descrição da Feature

Permite que qualquer responsável marque mensagens específicas como "juridicamente relevantes", destacando-as visualmente e incluindo-as automaticamente nos relatórios jurídicos. A marcação é reversível (pode ser desmarcada), mas a ação de marcar/desmarcar é registrada no audit_log.

---

## 2. Solução Proposta

Botão de marcação (ícone de balança ⚖️) acessível via long-press na mensagem ou menu de contexto. Mensagens marcadas recebem borda colorida (âmbar) e ícone visual. No relatório jurídico, existe opção de incluir apenas as mensagens marcadas ou todas.

---

## 3. Escopo

### O que ENTRA
- Botão de marcar/desmarcar mensagem como relevante
- Destaque visual na mensagem marcada (borda âmbar + ícone ⚖️)
- Aba de "Mensagens Relevantes" no chat para acesso rápido
- Campo `is_legally_relevant` na tabela messages (atualizável — única exceção ao insert-only)
- Audit_log: registra quem marcou/desmarcou e quando
- Inclusão automática no relatório jurídico (EP-07)

### O que NÃO ENTRA
- Marcação automática por IA — fase 2
- Categorização de mensagens relevantes (urgência, tipo) — fase 2
- Marcação visível para o outro responsável — por design é privada até exportação

---

## 4. Premissas

- A marcação é visível para ambos os responsáveis (mas não para terceiros)
- `is_legally_relevant` é o único campo de mensagens que pode ser atualizado (exceção explícita ao insert-only)
- O responsável que marca a mensagem aparece no audit_log

---

## 5. User Stories

| US | Tipo | Descrição | Esforço |
|----|------|-----------|---------|
| US-03.05.01 | Frontend | Como responsável, quero marcar uma mensagem como relevante via long-press | 2 |
| US-03.05.02 | Frontend | Como responsável, quero ver mensagens marcadas com destaque visual (borda âmbar) | 1 |
| US-03.05.03 | Frontend | Como responsável, quero acessar uma aba com todas as mensagens relevantes | 2 |
| US-03.05.04 | Backend | Endpoint PATCH /messages/:id/mark-relevant — toggle de marcação | 2 |
| US-03.05.05 | Backend | Audit_log: registrar marcação/desmarcação com userId e timestamp | 2 |
| US-03.05.06 | Backend | Endpoint GET /messages/relevant/:childId — lista todas as mensagens marcadas | 2 |

**Esforço Total**: 11 pontos

---

## 6. Critérios de Aceitação

- [ ] Marcação visual aparece para ambos os responsáveis em < 2 segundos
- [ ] Aba "Mensagens Relevantes" lista apenas as mensagens marcadas
- [ ] Audit_log registra 100% das marcações e desmarcações
- [ ] Mensagens relevantes aparecem no relatório PDF (EP-07)

---

## 7. Complexidade Técnica

**Nível**: Baixa | **Pontos**: 11
