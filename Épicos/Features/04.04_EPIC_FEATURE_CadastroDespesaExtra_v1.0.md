# F-04.04 — Cadastro de Despesa Extraordinária

**Épico**: EP-04 — Gestão Financeira  
**Agente**: @the-explorer  
**Versão**: 1.0 | **Data**: 2026-02-24

---

## 1. Descrição da Feature

Formulário de cadastro de despesa extraordinária do filho (saúde, escola, lazer, outro). O responsável informa categoria, valor, descrição e faz upload do comprovante/nota fiscal. A despesa entra em estado Pendente até que o outro responsável aprove ou conteste (F-04.05).

---

## 2. Solução Proposta

Formulário com seleção de categoria, campo de valor, descrição livre e upload obrigatório de nota fiscal ou comprovante. Após o cadastro, a despesa aparece para ambos os responsáveis com status "Pendente de aprovação". O responsável que cadastrou pode ver todas as suas despesas; o outro vê as pendentes em destaque.

---

## 3. Escopo

### O que ENTRA
- Categorias: Saúde, Educação, Lazer, Alimentação, Vestuário, Outro
- Campo de valor (R$) com 2 casas decimais
- Descrição obrigatória (até 500 caracteres)
- Upload de nota fiscal / comprovante (obrigatório, PDF ou imagem)
- Data da despesa (pode ser retroativa, mas com flag "retroativa")
- Divisão percentual sugerida (padrão: 50/50 configurável por F-02.01)

### O que NÃO ENTRA
- Integração com sistema de notas fiscais (SEFAZ) — fase 3
- Categorização automática por IA — fase 2
- Despesa recorrente (ex: mensalidade escolar mensal) — fase 2

---

## 4. Premissas

- Despesa retroativa (com data anterior) é aceita mas marcada como tal
- O upload de comprovante é obrigatório — sem ele o formulário não submete
- Qualquer responsável pode cadastrar despesa; a outra parte aprova

---

## 5. User Stories

| US | Tipo | Descrição | Esforço |
|----|------|-----------|---------|
| US-04.04.01 | Frontend | Como responsável, quero cadastrar uma despesa com categoria, valor, descrição e comprovante | 3 |
| US-04.04.02 | Frontend | Como responsável, quero ver minhas despesas cadastradas com status atual | 2 |
| US-04.04.03 | Frontend | Como responsável, quero ver despesas pendentes de aprovação em destaque | 2 |
| US-04.04.04 | Backend | Endpoint POST /expenses com upload integrado ao S3 | 3 |
| US-04.04.05 | Backend | Endpoint GET /expenses/:childId?status= — lista paginada com filtros | 2 |
| US-04.04.06 | Backend | Notificação push + email ao outro responsável ao cadastrar despesa | 2 |

**Esforço Total**: 14 pontos

---

## 6. Critérios de Aceitação

- [ ] Comprovante obrigatório — botão "Salvar" desativado sem upload
- [ ] Outro responsável notificado em < 60 segundos após cadastro
- [ ] Despesa aparece com status "Pendente" imediatamente após cadastro
- [ ] Despesa retroativa identificada com badge "Retroativa"

---

## 7. Complexidade Técnica

**Nível**: Baixa | **Pontos**: 14
