# F-01.03 — Convite e Aceite entre Responsáveis

**Épico**: EP-01 — Identidade & Acesso  
**Agente**: @the-explorer  
**Versão**: 1.0 | **Data**: 2026-02-24

---

## 1. Descrição da Feature

Fluxo de vínculo entre dois responsáveis legais de um mesmo filho. O Responsável 1 convida o Responsável 2 por email ou link. O Responsável 2 aceita o convite e ambos ficam vinculados à mesma criança com os devidos perfis e permissões.

---

## 2. Solução Proposta

- Responsável 1 cadastra o filho e envia convite por email ao Responsável 2
- Responsável 2 recebe email com link de convite (token com 72h de validade)
- Se Responsável 2 já tem conta: aceita o convite e fica vinculado
- Se não tem conta: cria conta e já fica vinculado ao aceitar
- Após vínculo: ambos veem o mesmo filho no dashboard

---

## 3. Escopo

### O que ENTRA
- Envio de convite por email
- Token de convite com expiração (72h)
- Aceite de convite (com ou sem conta)
- Vínculo pai-filho-pai no banco de dados
- Configuração inicial de tipo de guarda após vínculo

### O que NÃO ENTRA
- Convite por SMS ou WhatsApp — fase 2
- Convite mediado pela Vara da Família — fase Judicial
- Rejeição formal de convite — o convite simplesmente expira

---

## 4. Premissas

- Um filho pode ter no máximo 2 responsáveis principais no MVP
- O Responsável 1 define o tipo de guarda (compartilhada/unilateral) na configuração inicial
- Convite pode ser reenviado a qualquer momento
- Token de convite é de uso único

---

## 5. User Stories

| US | Tipo | Descrição | Esforço |
|----|------|-----------|---------|
| US-01.03.01 | Frontend | Como Responsável 1, quero convidar o co-guardião por email após cadastrar o filho | 3 |
| US-01.03.02 | Frontend | Como Responsável 2, quero aceitar o convite e ver o filho vinculado no meu app | 2 |
| US-01.03.03 | Frontend | Como Responsável 1, quero reenviar o convite expirado | 1 |
| US-01.03.04 | Backend | Endpoint POST /invite — gera token e envia email | 3 |
| US-01.03.05 | Backend | Endpoint POST /invite/accept — valida token e cria vínculo | 3 |
| US-01.03.06 | Backend | Expiração automática de convites não aceitos em 72h | 2 |

**Esforço Total**: 14 pontos

---

## 6. Critérios de Aceitação

- [ ] Email de convite chega em < 60 segundos
- [ ] Token expirado retorna erro claro com opção de solicitar novo convite
- [ ] Após aceite, Responsável 2 vê o filho no dashboard imediatamente
- [ ] Responsável 1 recebe notificação quando convite é aceito

---

## 7. Complexidade Técnica

**Nível**: Médio  
**Pontos**: 14  
**Riscos**: Token de convite deve ser single-use e seguro (evitar replay attacks)
