# F-04.02 — Registro de Pagamento de Pensão

**Épico**: EP-04 — Gestão Financeira  
**Agente**: @the-explorer  
**Versão**: 1.0 | **Data**: 2026-02-24

---

## 1. Descrição da Feature

Fluxo de registro de pagamento mensal de pensão alimentícia pelo responsável pagador. Inclui informação de valor pago (pode diferir do valor configurado), data real do pagamento e upload de comprovante. O beneficiário pode confirmar o recebimento ou contestar.

---

## 2. Solução Proposta

O responsável pagador acessa o mês de referência e clica em "Registrar Pagamento". Informa valor pago, data real e faz upload do comprovante. O beneficiário recebe notificação e pode confirmar recebimento ou contestar com motivo. Status do pagamento atualizado em tempo real.

---

## 3. Escopo

### O que ENTRA
- Registro de pagamento com data real, valor pago e comprovante (obrigatório)
- Valor pago pode ser diferente do configurado (parcial ou acrescido de multa)
- Confirmação de recebimento pelo beneficiário
- Contestação pelo beneficiário com motivo
- Status automático: Pago / Pago Parcialmente / Atrasado / Contestado
- Histórico de todas as transações por mês de referência

### O que NÃO ENTRA
- Integração bancária/PIX — fase 2
- Confirmação automática via extrato bancário — fase 2

---

## 4. Premissas

- O comprovante é obrigatório para marcar como Pago
- Status "Atrasado" é automático após o dia de vencimento sem pagamento registrado
- O beneficiário tem até 72h para contestar após a confirmação de pagamento

---

## 5. User Stories

| US | Tipo | Descrição | Esforço |
|----|------|-----------|---------|
| US-04.02.01 | Frontend | Como pagador, quero registrar o pagamento do mês com valor, data e comprovante | 3 |
| US-04.02.02 | Frontend | Como beneficiário, quero confirmar o recebimento ou contestar o pagamento | 2 |
| US-04.02.03 | Frontend | Como responsável, quero ver o status de cada mês de pensão (pago/atrasado/contestado) | 2 |
| US-04.02.04 | Backend | Endpoint POST /alimony/payment com upload de comprovante | 3 |
| US-04.02.05 | Backend | Endpoint POST /alimony/payment/:id/confirm — beneficiário confirma | 2 |
| US-04.02.06 | Backend | Endpoint POST /alimony/payment/:id/contest — beneficiário contesta com motivo | 2 |
| US-04.02.07 | Backend | Job cron: atualizar status para Atrasado após vencimento sem pagamento | 3 |
| US-04.02.08 | Backend | Notificação ao beneficiário quando pagamento é registrado | 2 |

**Esforço Total**: 19 pontos

---

## 6. Critérios de Aceitação

- [ ] Comprovante obrigatório — sem comprovante o formulário não submete
- [ ] Status muda para Atrasado automaticamente 1 dia após o vencimento
- [ ] Beneficiário notificado em < 60 segundos após registro do pagamento
- [ ] Contestação com motivo registrada de forma imutável

---

## 7. Complexidade Técnica

**Nível**: Média | **Pontos**: 19
