# F-02.06 — Registro de Cumprimento, Atraso, Falta e Cancelamento

**Épico**: EP-02 — Guarda & Convivência  
**Agente**: @the-explorer  
**Versão**: 1.0 | **Data**: 2026-02-24

---

## 1. Descrição da Feature

Para cada evento de convivência no calendário, o responsável ativo registra o que ocorreu: cumprimento (check-in/check-out com horário real), atraso, falta ou cancelamento. Cada registro gera um log imutável com data/hora e opcionalmente um campo de observação. Este log é a principal fonte de dados para relatórios jurídicos.

---

## 2. Solução Proposta

Ao clicar em um evento do calendário, o responsável vê as opções de registro. Cada ação é salva com timestamp do servidor (não do device), garantindo integridade. O outro responsável recebe notificação sobre o registro.

---

## 3. Escopo

### O que ENTRA
- Check-in: responsável confirma retirada da criança (com horário real)
- Check-out: responsável confirma devolução da criança (com horário real)
- Registro de atraso com tempo de atraso calculado automaticamente
- Registro de falta com campo de observação obrigatório
- Registro de cancelamento com motivo (livre) e responsável que cancelou
- Log imutável: nenhum registro pode ser editado após confirmação
- Notificação para o outro responsável

### O que NÃO ENTRA
- Geolocalização no check-in/check-out — fase 2
- Testemunhas digitais — fase Judicial
- Integração com câmeras — não aplicável

---

## 4. Premissas

- O timestamp é do servidor (UTC) — não confia no horário do device
- Uma vez registrado, não pode ser alterado (apenas novo registro complementar pode ser adicionado)
- O responsável que NÃO está com a criança no período pode registrar FALTA se o outro não aparecer
- Ambos os responsáveis veem todos os registros do filho

---

## 5. User Stories

| US | Tipo | Descrição | Esforço |
|----|------|-----------|---------|
| US-02.06.01 | Frontend | Como responsável, quero registrar check-in (retirada) com horário real ao clicar no evento | 3 |
| US-02.06.02 | Frontend | Como responsável, quero registrar check-out (devolução) com horário real | 3 |
| US-02.06.03 | Frontend | Como responsável, quero registrar atraso com o motivo | 2 |
| US-02.06.04 | Frontend | Como responsável, quero registrar falta com observação obrigatória | 2 |
| US-02.06.05 | Frontend | Como responsável, quero registrar cancelamento com motivo | 2 |
| US-02.06.06 | Frontend | Como responsável, quero ver o histórico de registros de um evento específico | 2 |
| US-02.06.07 | Backend | Endpoint POST /attendance/checkin — registra check-in com timestamp servidor | 3 |
| US-02.06.08 | Backend | Endpoint POST /attendance/checkout | 2 |
| US-02.06.09 | Backend | Endpoint POST /attendance/absence | 2 |
| US-02.06.10 | Backend | Endpoint POST /attendance/cancellation | 2 |
| US-02.06.11 | Backend | Regra: qualquer registro é imutável após criação | 2 |
| US-02.06.12 | Backend | Notificação push para o outro responsável ao registrar qualquer evento | 2 |

**Esforço Total**: 27 pontos

---

## 6. Critérios de Aceitação

- [ ] Timestamp do registro usa horário do servidor (não do device)
- [ ] Após confirmação, botão de edição não existe
- [ ] Outro responsável recebe push notification em < 30 segundos
- [ ] Relatório de convivência reflete 100% dos registros

---

## 7. Complexidade Técnica

**Nível**: Média  
**Pontos**: 27  
**Riscos**: Garantia de imutabilidade (nível de banco de dados), fuso horário
