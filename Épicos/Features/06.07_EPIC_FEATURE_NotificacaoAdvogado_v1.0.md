# F-06.07 — Notificação para Advogado Cadastrado (Alta/Crítica)

**Épico**: EP-06 — Ocorrências & Incidentes  
**Agente**: @the-explorer  
**Versão**: 1.0 | **Data**: 2026-02-24

---

## 1. Descrição da Feature

Notificação automática ao advogado vinculado quando uma ocorrência de gravidade Alta ou Crítica é registrada. O advogado recebe email + push (se tiver o app) com resumo da ocorrência e link direto para visualização no seu painel de clientes.

---

## 2. Solução Proposta

Após o INSERT de uma ocorrência com gravidade >= ALTA, o serviço de notificações verifica se há advogado vinculado ao responsável/filho. Se sim, dispara email com: nome do responsável, nome do filho, tipo da ocorrência, gravidade, data do fato e link para o painel. Push FCM se o advogado tiver o app instalado.

---

## 3. Escopo

### O que ENTRA
- Trigger pós-INSERT de ocorrência Alta/Crítica → notificação ao advogado
- Email: resumo + link para painel do advogado
- Push FCM (se app instalado e device registrado)
- SLA de entrega: Crítica < 5 minutos, Alta < 60 minutos
- Registro da notificação no notification_log com status de entrega

### O que NÃO ENTRA
- Notificação via SMS — fase 2
- Notificação automática para a Vara da Família — fase Judicial
- Escalation se advogado não responder — fase 2

---

## 4. Premissas

- Notificação só ocorre se há advogado vinculado E autorizado para o módulo de ocorrências
- O advogado pode configurar preferências de notificação (ex: só Críticas)
- O responsável é notificado que o advogado foi alertado (confirmação)

---

## 5. User Stories

| US | Tipo | Descrição | Esforço |
|----|------|-----------|---------|
| US-06.07.01 | Backend | Serviço: após INSERT de ocorrência Alta/Crítica, verificar advogado vinculado | 3 |
| US-06.07.02 | Backend | Email ao advogado com resumo e link para painel | 2 |
| US-06.07.03 | Backend | Push FCM ao advogado (se device registrado) | 2 |
| US-06.07.04 | Backend | Registrar notificação no notification_log com status de entrega | 2 |
| US-06.07.05 | Frontend | Como responsável, quero ver confirmação de que meu advogado foi alertado | 1 |

**Esforço Total**: 10 pontos

---

## 6. Critérios de Aceitação

- [ ] Email ao advogado chega em < 5 minutos para Crítica
- [ ] Email ao advogado chega em < 60 minutos para Alta
- [ ] Notification_log registra status de entrega (success/failed)
- [ ] Responsável vê confirmação "Seu advogado foi notificado" na tela

---

## 7. Complexidade Técnica

**Nível**: Baixa | **Pontos**: 10
