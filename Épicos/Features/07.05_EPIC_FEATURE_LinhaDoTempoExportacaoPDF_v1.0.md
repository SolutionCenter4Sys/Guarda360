# F-07.05 / F-07.08 — Linha do Tempo Unificada + Exportação PDF Jurídico

**Épico**: EP-07 — Relatórios & Exportação Jurídica  
**Agente**: @the-explorer  
**Versão**: 1.0 | **Data**: 2026-02-24

---

## 1. Descrição da Feature

Linha do tempo cronológica unificada de todos os eventos relacionados à criança (visitas, mensagens, pagamentos, incidentes) e geração de relatório PDF profissional e juridicamente estruturado, com hash de integridade SHA-256, pronto para uso em processos judiciais.

---

## 2. Solução Proposta

**Linha do Tempo**:
- Feed cronológico reverso com filtros por tipo de evento e período
- Cada item exibe: data/hora, tipo, resumo, responsável, ícone por categoria
- Seleção de itens para incluir no relatório

**Exportação PDF**:
- Capa com dados do processo (filho, responsáveis, período)
- Seções por módulo (convivência, chat, financeiro, incidentes)
- Assinatura digital do documento
- Hash SHA-256 impresso na capa para verificação
- Geração assíncrona com notificação por email quando pronto

---

## 3. Escopo

### O que ENTRA
- Feed de linha do tempo com todos os tipos de evento
- Filtros por: período, tipo (convivência/chat/financeiro/incidentes), responsável
- Seleção de quais módulos incluir no PDF
- Seleção de período do relatório (data inicial e final)
- Geração de PDF com formatação profissional
- Hash SHA-256 do PDF gerado
- Email com link para download do PDF
- PDF armazenado em S3 por 90 dias

### O que NÃO ENTRA
- Assinatura com certificado ICP-Brasil — fase Judicial
- Modo Judicial (congelamento de dados) — feature separada (F-07.11)
- Envio direto para Vara da Família — fase futura
- Relatório em formato DOCX — apenas PDF

---

## 4. Premissas

- Qualquer responsável pode gerar relatório de seus próprios dados
- Ocorrências aparecem no relatório do responsável que as criou
- Chat: apenas mensagens marcadas como "juridicamente relevantes" são incluídas por padrão (mas pode incluir tudo)
- Geração de PDF é assíncrona (pode levar 1-3 minutos para períodos longos)
- PDF expira em S3 após 90 dias (link de download expira em 24h)

---

## 5. User Stories

| US | Tipo | Descrição | Esforço |
|----|------|-----------|---------|
| US-07.05.01 | Frontend | Como responsável, quero ver a linha do tempo de todos os eventos do meu filho | 5 |
| US-07.05.02 | Frontend | Como responsável, quero filtrar a linha do tempo por tipo e período | 3 |
| US-07.05.03 | Frontend | Como responsável, quero selecionar o período e módulos para gerar o relatório | 3 |
| US-07.05.04 | Frontend | Como responsável, quero acompanhar o progresso da geração do PDF | 2 |
| US-07.05.05 | Frontend | Como responsável, quero baixar o PDF gerado e ver o hash de integridade | 2 |
| US-07.05.06 | Backend | Endpoint GET /timeline/{childId}?from=&to=&types= — linha do tempo paginada | 5 |
| US-07.05.07 | Backend | Endpoint POST /reports/generate — inicia geração assíncrona do PDF | 3 |
| US-07.05.08 | Backend | Worker: gera PDF com Puppeteer (template HTML → PDF) | 8 |
| US-07.05.09 | Backend | Geração de hash SHA-256 do PDF | 2 |
| US-07.05.10 | Backend | Upload do PDF para S3 + geração de URL assinada (24h) | 3 |
| US-07.05.11 | Backend | Email de notificação com link de download | 2 |
| US-07.05.12 | Backend | Endpoint GET /reports/{id}/status — polling de status da geração | 2 |

**Esforço Total**: 40 pontos

---

## 6. Critérios de Aceitação

- [ ] Linha do tempo carrega eventos de 12 meses em < 3 segundos
- [ ] PDF de 6 meses gerado em < 3 minutos
- [ ] Hash SHA-256 do PDF é único e verificável externamente
- [ ] PDF tem formatação profissional (capa, índice, seções, rodapé com hash)
- [ ] Email com link chega em < 5 minutos após disparo

---

## 7. Complexidade Técnica

**Nível**: Alta  
**Pontos**: 40  
**Riscos**: Geração assíncrona de PDF (Puppeteer em produção), volume de dados para períodos longos, custo de S3
