# F-03.06 — Exportação do Chat Selecionado em PDF

**Épico**: EP-03 — Comunicação Monitorada  
**Agente**: @the-explorer  
**Versão**: 1.0 | **Data**: 2026-02-24

---

## 1. Descrição da Feature

Exportação do histórico de chat em PDF com formatação profissional e valor jurídico. O responsável seleciona o período e quais mensagens incluir (todas ou apenas as marcadas como relevantes). O PDF gerado inclui cabeçalho, metadados de integridade e hash SHA-256.

---

## 2. Solução Proposta

Usa o mesmo worker de PDF dos relatórios (EP-07) com template específico para chat. Geração assíncrona via BullMQ. O PDF renderiza as mensagens com remetente, timestamp e indicação visual de mensagens relevantes. Hash SHA-256 calculado sobre o conteúdo do PDF.

---

## 3. Escopo

### O que ENTRA
- Seleção de período e filtro (todas / apenas relevantes)
- PDF com: cabeçalho (nome dos responsáveis, nome do filho, período), mensagens com remetente e timestamp, marcação de mensagens relevantes
- Hash SHA-256 do PDF na capa
- Envio por email quando pronto (geração assíncrona)
- Download direto se gerado em < 30 segundos

### O que NÃO ENTRA
- Export de áudios no PDF (apenas transcrição automática) — fase 2
- Assinatura digital ICP-Brasil — fase Judicial

---

## 4. Premissas

- Áudios aparecem no PDF como "[Mensagem de áudio - HH:mm - duração: Xs]" sem transcrição
- Imagens aparecem inline no PDF (até 5MB) ou como "[Imagem anexa]" se maior
- O PDF exportado é armazenado no S3 por 90 dias

---

## 5. User Stories

| US | Tipo | Descrição | Esforço |
|----|------|-----------|---------|
| US-03.06.01 | Frontend | Como responsável, quero selecionar período e tipo de mensagens para exportar em PDF | 2 |
| US-03.06.02 | Frontend | Como responsável, quero acompanhar o status da geração e baixar quando pronto | 2 |
| US-03.06.03 | Backend | Endpoint POST /reports/chat — enfileira job de exportação de chat | 2 |
| US-03.06.04 | Backend | Worker PDF: renderiza template de chat com mensagens + timestamps + metadados | 8 |
| US-03.06.05 | Backend | Calcula hash SHA-256 do PDF e salva no S3 | 2 |
| US-03.06.06 | Backend | Email com link de download (24h) quando PDF estiver pronto | 2 |

**Esforço Total**: 18 pontos

---

## 6. Critérios de Aceitação

- [ ] PDF de 30 dias de chat gerado em < 60 segundos
- [ ] Hash SHA-256 do PDF é verificável externamente
- [ ] Mensagens relevantes estão destacadas no PDF
- [ ] Email chega em < 5 minutos após solicitação

---

## 7. Complexidade Técnica

**Nível**: Alta | **Pontos**: 18
