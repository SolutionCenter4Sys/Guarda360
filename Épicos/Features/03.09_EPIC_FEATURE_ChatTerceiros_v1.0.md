# F-03.09 — Chat com Terceiros Autorizados (Modo Leitura para Profissionais)

**Épico**: EP-03 — Comunicação Monitorada  
**Agente**: @the-explorer  
**Versão**: 1.0 | **Data**: 2026-02-24

---

## 1. Descrição da Feature

Acesso read-only ao histórico de chat para profissionais autorizados (advogados, psicólogos, mediadores). O profissional pode ver as mensagens marcadas como relevantes, ou todo o histórico se o responsável autorizar. Não pode enviar mensagens, apenas ler e fazer anotações internas (não visíveis pelos responsáveis).

---

## 2. Solução Proposta

Na conta do profissional, ao selecionar um cliente, há uma seção "Chat" que exibe apenas as mensagens relevantes por padrão. O responsável pode expandir o acesso para o histórico completo nas configurações de permissão. Anotações do profissional ficam em tabela separada, não visíveis pelos responsáveis.

---

## 3. Escopo

### O que ENTRA
- Acesso read-only ao chat do cliente pelo profissional autorizado
- Por padrão: apenas mensagens marcadas como relevantes
- Opção do responsável: liberar acesso ao histórico completo
- Profissional pode adicionar anotações privadas sobre mensagens (não visíveis pelos responsáveis)
- Audit_log de todos os acessos do profissional ao chat

### O que NÃO ENTRA
- Profissional enviando mensagens no chat entre os responsáveis — jamais
- Profissional deletando ou marcando mensagens — read-only absoluto
- Chat separado entre responsável e profissional — fase 2

---

## 4. Premissas

- O acesso do profissional ao chat deve ser explicitamente autorizado pelo responsável
- A autorização é granular: "apenas relevantes" (padrão) ou "histórico completo" (opt-in)
- O profissional não sabe que existe um sistema de marcação de relevância — vê apenas o resultado

---

## 5. User Stories

| US | Tipo | Descrição | Esforço |
|----|------|-----------|---------|
| US-03.09.01 | Frontend | Como profissional, quero ver as mensagens relevantes do chat do meu cliente | 3 |
| US-03.09.02 | Frontend | Como profissional, quero adicionar anotações privadas em mensagens específicas | 2 |
| US-03.09.03 | Frontend | Como responsável, quero configurar o nível de acesso do meu profissional ao chat | 2 |
| US-03.09.04 | Backend | RBAC: profissional acessa apenas mensagens is_legally_relevant=true por padrão | 3 |
| US-03.09.05 | Backend | RBAC: responsável pode expandir acesso para histórico completo | 2 |
| US-03.09.06 | Backend | Tabela professional_notes: anotações privadas do profissional | 3 |
| US-03.09.07 | Backend | Audit_log: registrar cada acesso do profissional ao chat | 2 |

**Esforço Total**: 17 pontos

---

## 6. Critérios de Aceitação

- [ ] Profissional sem autorização específica não acessa o chat (403)
- [ ] Profissional com acesso "padrão" não vê mensagens não-relevantes
- [ ] Anotações do profissional não aparecem para os responsáveis
- [ ] Todo acesso registrado no audit_log

---

## 7. Complexidade Técnica

**Nível**: Média | **Pontos**: 17  
**Riscos**: RBAC com múltiplos níveis de acesso ao chat requer testes exaustivos
