# F-02.03 — Configuração de Trocas Automáticas (Quinzenal etc.)

**Épico**: EP-02 — Guarda & Convivência  
**Agente**: @the-explorer  
**Versão**: 1.0 | **Data**: 2026-02-24

---

## 1. Descrição da Feature

Sistema de criação automática de eventos de convivência com base em regras recorrentes definidas na configuração da guarda. Elimina a necessidade de criar manualmente cada evento de visita — o sistema gera automaticamente com base no padrão configurado.

---

## 2. Solução Proposta

Engine de recorrência baseado em padrões configurados (alternado semanal, quinzenal, fins de semana). Um job cron gera os próximos 3 meses de eventos automaticamente, sempre mantendo o calendário populado com antecedência. Qualquer evento gerado pode ser ajustado pontualmente sem alterar o padrão geral.

---

## 3. Escopo

### O que ENTRA
- Regras de recorrência: alternado semanal, quinzenal (ímpar/par), fins de semana alternados, custom
- Geração automática de 3 meses futuros de eventos
- Job cron: executa mensalmente para gerar novos eventos
- Ajuste pontual de evento gerado (sem alterar o padrão)
- Exibição de eventos gerados automaticamente vs. criados manualmente (marcação visual)

### O que NÃO ENTRA
- Recorrência baseada em RRULE completo (RFC 5545) — fase 2
- Integração com calendários externos para detectar conflitos — fase 2

---

## 4. Premissas

- Eventos gerados automaticamente têm flag `auto_generated = true`
- Ajuste pontual cria um novo evento substituindo o automático (não altera a regra)
- O padrão de recorrência usa a data de início configurada em F-02.01 como âncora

---

## 5. User Stories

| US | Tipo | Descrição | Esforço |
|----|------|-----------|---------|
| US-02.03.01 | Frontend | Como responsável, quero ver no calendário os eventos gerados automaticamente com marcação visual | 2 |
| US-02.03.02 | Frontend | Como responsável, quero ajustar um evento automático pontualmente sem alterar o padrão | 3 |
| US-02.03.03 | Backend | Engine de recorrência: gera eventos com base nas regras configuradas | 8 |
| US-02.03.04 | Backend | Job cron mensal: gera próximos 3 meses de eventos automaticamente | 3 |
| US-02.03.05 | Backend | Lógica de substituição de evento automático por ajuste pontual | 3 |

**Esforço Total**: 19 pontos

---

## 6. Critérios de Aceitação

- [ ] Após configuração inicial, 3 meses de eventos aparecem no calendário em < 5 segundos
- [ ] Job cron executa sem erros e sem duplicar eventos já criados
- [ ] Ajuste pontual não altera eventos passados nem futuros além do específico

---

## 7. Complexidade Técnica

**Nível**: Alta | **Pontos**: 19  
**Riscos**: Lógica de recorrência tem muitos edge cases; idempotência do job cron é crítica
