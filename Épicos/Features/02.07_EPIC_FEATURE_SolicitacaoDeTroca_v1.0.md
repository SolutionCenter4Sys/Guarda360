# F-02.07 — Solicitação de Troca de Dia

**Épico**: EP-02 — Guarda & Convivência  
**Agente**: @the-explorer  
**Versão**: 1.0 | **Data**: 2026-02-24

---

## 1. Descrição da Feature

Fluxo formal para solicitar e aprovar trocas de dia de convivência. Um responsável propõe a troca (evento A por evento B), o outro aceita ou recusa, e a decisão é registrada com timestamp imutável — independentemente do canal de comunicação informal usado.

---

## 2. Solução Proposta

O responsável seleciona um evento futuro e propõe uma troca para outra data, indicando o evento que oferece em compensação. O outro responsável recebe a proposta com prazo de 72h para responder. Resposta aceita → ambos os eventos são atualizados. Recusado → mantém original com registro da recusa.

---

## 3. Escopo

### O que ENTRA
- Proposta de troca: evento de origem + evento de compensação (ou data livre)
- Prazo de 72h para o outro responsável responder
- Aceite: ambos os eventos são remarcados + registro imutável da troca
- Recusa: evento original mantido + registro da recusa com motivo opcional
- Histórico de trocas aceitas e recusadas

### O que NÃO ENTRA
- Troca sem compensação (unilateral) — por design requer evento de compensação
- Troca de eventos passados — apenas eventos futuros
- Mediação automática em caso de recusa — fase Judicial

---

## 4. Premissas

- Uma troca só altera eventos futuros (mínimo 48h de antecedência)
- Expiração da proposta (72h sem resposta) mantém o calendário original
- O histórico de trocas recusadas é visível para relatórios jurídicos

---

## 5. User Stories

| US | Tipo | Descrição | Esforço |
|----|------|-----------|---------|
| US-02.07.01 | Frontend | Como responsável, quero propor uma troca selecionando o evento a trocar e o compensatório | 3 |
| US-02.07.02 | Frontend | Como responsável, quero receber a proposta e aceitar ou recusar com comentário | 2 |
| US-02.07.03 | Frontend | Como responsável, quero ver o histórico de trocas do filho | 2 |
| US-02.07.04 | Backend | Endpoint POST /swap-requests — cria proposta de troca | 3 |
| US-02.07.05 | Backend | Endpoint POST /swap-requests/:id/accept — aceita e remarca os eventos | 3 |
| US-02.07.06 | Backend | Endpoint POST /swap-requests/:id/reject — recusa com motivo | 2 |
| US-02.07.07 | Backend | Job: expirar propostas não respondidas após 72h | 2 |

**Esforço Total**: 17 pontos

---

## 6. Critérios de Aceitação

- [ ] Troca aceita atualiza os dois eventos atomicamente (transação banco)
- [ ] Proposta expirada é registrada como "Expirada" no histórico
- [ ] Não é possível propor troca com menos de 48h de antecedência

---

## 7. Complexidade Técnica

**Nível**: Média | **Pontos**: 17
