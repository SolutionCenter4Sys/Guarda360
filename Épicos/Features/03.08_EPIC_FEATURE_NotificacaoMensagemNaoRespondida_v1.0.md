# F-03.08 — Notificação de Mensagem Não Respondida

**Épico**: EP-03 — Comunicação Monitorada  
**Agente**: @the-explorer  
**Versão**: 1.0 | **Data**: 2026-02-24

---

## 1. Descrição da Feature

Sistema de alertas automáticos para mensagens que ficaram sem resposta por mais de 24 horas. Alerta o remetente (para saber que a mensagem não foi respondida) e registra o não-atendimento como dado para relatório jurídico.

---

## 2. Solução Proposta

Job cron diário verifica mensagens sem resposta nas últimas 24h. Envia push notification ao remetente informando que a mensagem não foi respondida. O registro de "não respondida" fica disponível na linha do tempo e no relatório jurídico como dado de comunicação.

---

## 3. Escopo

### O que ENTRA
- Job cron: verificar mensagens sem resposta após 24h
- Push + email ao remetente: "Sua mensagem de [data] ainda não foi respondida"
- Campo `read_at` na tabela messages para rastrear leitura
- Indicadores de leitura no chat (✓ enviado, ✓✓ lido)
- Dado de "mensagem não respondida" disponível no relatório jurídico
- Painel no dashboard: contador de mensagens não respondidas

### O que NÃO ENTRA
- Prazo legal de resposta — contexto jurídico define isso, não o app
- Bloqueio do outro responsável por não responder — fora do escopo
- Escalation para advogado automaticamente — fase 2

---

## 4. Premissas

- "Resposta" = qualquer mensagem enviada de volta após a mensagem original
- Leitura (read_at) é registrada quando a mensagem aparece na tela do destinatário
- O remetente recebe no máximo 1 alerta por "thread" não respondida (não spam)

---

## 5. User Stories

| US | Tipo | Descrição | Esforço |
|----|------|-----------|---------|
| US-03.08.01 | Frontend | Como responsável, quero ver indicadores ✓ / ✓✓ em cada mensagem | 2 |
| US-03.08.02 | Frontend | Como responsável, quero ver no dashboard quantas mensagens não foram respondidas | 2 |
| US-03.08.03 | Backend | Registrar read_at quando mensagem é renderizada na tela do destinatário | 3 |
| US-03.08.04 | Backend | Endpoint PATCH /messages/:id/read — marca mensagem como lida | 1 |
| US-03.08.05 | Backend | Job cron diário: detecta mensagens sem resposta após 24h e notifica | 3 |
| US-03.08.06 | Backend | Endpoint GET /messages/unread-count/:childId — contador para dashboard | 1 |

**Esforço Total**: 12 pontos

---

## 6. Critérios de Aceitação

- [ ] ✓✓ aparece em < 2 segundos após o destinatário abrir o chat
- [ ] Alerta de não-respondida chega exatamente 24h após o envio (± 1h)
- [ ] Máximo 1 alerta por "thread" não respondida
- [ ] Contador no dashboard reflete o número correto de não-respondidas

---

## 7. Complexidade Técnica

**Nível**: Baixa-Média | **Pontos**: 12
