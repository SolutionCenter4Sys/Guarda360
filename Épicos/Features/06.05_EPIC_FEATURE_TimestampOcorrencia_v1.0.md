# F-06.05 — Timestamp Imutável de Cada Ocorrência

**Épico**: EP-06 — Ocorrências & Incidentes  
**Agente**: @the-explorer  
**Versão**: 1.0 | **Data**: 2026-02-24

---

## 1. Descrição da Feature

Garantia de que o timestamp de cada ocorrência é capturado exclusivamente pelo servidor no momento do INSERT, não sendo possível manipular a data/hora por nenhum usuário. O timestamp compõe o hash de integridade e é exibido de forma proeminente em cada ocorrência.

---

## 2. Solução Proposta

Coluna `created_at TIMESTAMPTZ DEFAULT NOW()` na tabela incidents — o valor é sempre definido pelo PostgreSQL, nunca pelo cliente. O campo de "Data do fato" (quando o fato ocorreu, que pode ser diferente da data de registro) é um campo separado e opcional — permite registrar um fato ocorrido ontem.

---

## 3. Escopo

### O que ENTRA
- `created_at`: timestamp do servidor no momento do registro (imutável, valor do PostgreSQL)
- `incident_date`: data/hora em que o fato ocorreu (informada pelo usuário, pode ser retroativa)
- Ambas as datas visíveis no detalhe da ocorrência
- Ambas as datas presentes no hash de integridade
- Exibição clara: "Fato ocorrido em: DD/MM/AAAA HH:mm" + "Registrado em: DD/MM/AAAA HH:mm"

### O que NÃO ENTRA
- Notarização de timestamp por autoridade externa — fase Judicial
- Sincronização com relógio atômico — desnecessário para o MVP

---

## 4. Premissas

- `created_at` nunca aceita valor do cliente (DEFAULT NOW() e ignorado no payload)
- `incident_date` é opcional; se não informado, assume `created_at`
- Ambas as datas fazem parte do hash composto da ocorrência

---

## 5. User Stories

| US | Tipo | Descrição | Esforço |
|----|------|-----------|---------|
| US-06.05.01 | Frontend | Como responsável, quero informar quando o fato ocorreu (pode diferir do momento do registro) | 2 |
| US-06.05.02 | Frontend | Como responsável, quero ver ambas as datas (fato + registro) na ocorrência | 1 |
| US-06.05.03 | Backend | Implementar incident_date como campo separado e opcional | 1 |
| US-06.05.04 | Backend | Garantir que created_at é sempre DEFAULT NOW() (test de integração) | 2 |
| US-06.05.05 | Backend | Incluir ambas as datas no cálculo do hash de integridade | 2 |

**Esforço Total**: 8 pontos

---

## 6. Critérios de Aceitação

- [ ] Enviar `created_at: "2020-01-01"` no payload → ignorado, servidor usa NOW()
- [ ] `incident_date` retroativa (7 dias atrás) aceita sem erro
- [ ] Ambas as datas aparecem no PDF do relatório de ocorrências

---

## 7. Complexidade Técnica

**Nível**: Baixa | **Pontos**: 8
