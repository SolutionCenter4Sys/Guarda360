# F-04.01 — Configuração e Registro de Pensão Alimentícia

**Épico**: EP-04 — Gestão Financeira  
**Agente**: @the-explorer  
**Versão**: 1.0 | **Data**: 2026-02-24

---

## 1. Descrição da Feature

Módulo completo de gestão da pensão alimentícia: configuração do valor (fixo ou percentual), datas de vencimento, registro de pagamentos com upload de comprovante e histórico de inadimplência. Tudo com valor jurídico.

---

## 2. Solução Proposta

- Responsável 1 configura a pensão (valor, data vencimento, responsável pagador)
- A cada vencimento, o responsável pagador registra o pagamento + comprovante
- O outro responsável confirma ou contesta o pagamento
- Histórico completo com status: Pago, Pendente, Atrasado, Contestado

---

## 3. Escopo

### O que ENTRA
- Configuração de pensão (valor fixo em R$ ou % de renda declarada)
- Data de vencimento mensal
- Registro de pagamento com data e valor real pago
- Upload de comprovante (PDF, imagem)
- Status automático: Pago / Atrasado / Pendente
- Histórico de 24 meses
- Alertas: 3 dias antes do vencimento
- Relatório de inadimplência

### O que NÃO ENTRA
- Integração bancária (PIX automático) — fase 2
- Cálculo automático de percentual sobre holerite — fase 2
- Reajuste por INPC automático — fase 2

---

## 4. Premissas

- Quem configura a pensão é o Responsável 1 (inicialmente)
- Ambos os responsáveis podem registrar o pagamento (quem paga registra)
- Comprovante é obrigatório para marcar como Pago
- Status "Atrasado" é calculado automaticamente 1 dia após vencimento

---

## 5. User Stories

| US | Tipo | Descrição | Esforço |
|----|------|-----------|---------|
| US-04.01.01 | Frontend | Como responsável, quero configurar o valor e data de vencimento da pensão | 3 |
| US-04.01.02 | Frontend | Como responsável, quero registrar o pagamento com valor e comprovante | 3 |
| US-04.01.03 | Frontend | Como responsável, quero ver o histórico de pagamentos com status por mês | 3 |
| US-04.01.04 | Frontend | Como responsável, quero receber alerta 3 dias antes do vencimento | 2 |
| US-04.01.05 | Backend | Endpoint POST /alimony/config — configura pensão | 2 |
| US-04.01.06 | Backend | Endpoint POST /alimony/payment — registra pagamento + comprovante S3 | 3 |
| US-04.01.07 | Backend | Job automático: calcula status Atrasado a cada dia | 3 |
| US-04.01.08 | Backend | Endpoint GET /alimony/history/{childId} — histórico paginado | 2 |
| US-04.01.09 | Backend | Serviço de notificação de vencimento (3 dias antes) | 2 |

**Esforço Total**: 23 pontos

---

## 6. Critérios de Aceitação

- [ ] Status muda para Atrasado automaticamente 1 dia após vencimento
- [ ] Comprovante é obrigatório para marcar como Pago
- [ ] Histórico de 24 meses disponível em < 2 segundos
- [ ] Alert chega no device 3 dias antes do vencimento

---

## 7. Complexidade Técnica

**Nível**: Média  
**Pontos**: 23  
**Riscos**: Job de atualização de status pode falhar — implementar com retry e idempotência
